

<!DOCTYPE html>

	<html lang="en-US">

	<head>
		<meta charset="UTF-8">
		<meta http-equiv="x-ua-compatible" content="ie=edge">
		<meta name="viewport" content="width=device-width, minimum-scale=1.0">
		
			<title>OpenVPN | r-pi</title>
		
		
			<meta name="description" content="OpenVPN â€” Description">
		
		
		<link rel="icon" href="/favicon.ico" type="image/x-icon">
		<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=IBM+Plex+Mono|IBM+Plex+Sans:400,400i,500,500i,700,700i">
		<link rel="stylesheet" href="/dox-theme/assets/css/style.css">
	</head>
	<body>
		
			<div class="c-offcanvas">
				<div class="c-offcanvas__inner">
					
						<ul class="c-nav c-nav--stacked u-mx-auto">
							
								<li><a href="/">Homepage</a></li>
							
						</ul><!-- /.c-nav -->
					
					
						
							<a href="/documentation" class="c-btn c-btn--md c-btn--gray u-text-md">
								Documentation
								<div class="c-btn__icon">
									<i class="o-icon o-icon--folder"></i>
								</div>
							</a>
						
					
				</div><!-- /.c-offcanvas__inner -->
			</div><!-- /.c-offcanvas -->
		

		
			<header class="c-header">
				<div class="o-container">
					<div class="o-row">
						<div class="o-col-12">
							<div class="u-flex u-items-center">
								
									
										<p class="c-logo u-mb-0 js-logo">
											<a href="/" class="c-logo__link">r-pi</a>
										</p><!-- /.c-logo -->
									
								
								
									<div class="u-flex u-items-center u-ml-auto">
										
											<ul class="c-nav u-mb-0 u-hidden u-block@lg">
												
													
													<li class=""><a href="/">Homepage</a></li>
												
											</ul><!-- /.c-nav -->
										
										
											<div class="u-ml-5 u-hidden u-block@lg">
												
													<a href="/documentation" class="c-btn c-btn--md c-btn--gray u-text-md">
														Documentation
														<div class="c-btn__icon">
															<i class="o-icon o-icon--folder"></i>
														</div>
													</a>
												
											</div>
										
									</div>
								
								<button class="c-hamburger-icon c-hamburger-icon--slider js-hamburger-icon js-offcanvas-toggle u-ml-auto u-hidden@lg" type="button">
									<span class="c-hamburger-icon__box">
										<span class="c-hamburger-icon__inner"></span>
									</span><!-- /.c-hamburger-icon__box -->
								</button><!-- /.c-hamburger-icon -->
							</div>
						</div><!-- /.o-col -->
					</div><!-- /.o-row -->
				</div><!-- /.o-container -->
			</header><!-- /.c-header -->
		







	
		<div class="c-hero u-bg-gray-30 u-pt-16 u-pb-10">
	
		<div class="o-container">
			<div class="o-row">
				<div class="o-col-8@lg o-col-7@xl">
					
						<h2 class="u-text-lg u-text-xl@sm">OpenVPN</h2>
					
					
						<div class="u-h6">
							<p>Install a VPN server with OpenVPN.</p>
						</div>
					
					
					
				</div><!-- /.o-col -->
			</div><!-- /.o-row -->
		</div><!-- /.o-container -->
	</div>




	<div class="u-pt-8 u-pb-5">
		<div class="o-container">
			<div class="o-row">
				
					<div class="o-col-8@lg o-col-7@xl">
						<div class="c-post u-mb-3@lg js-post">
							<h6 id="install-openvpn-and-openssl">Install openvpn and openssl.</h6>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>apt-get <span class="nb">install </span>openvpn openssl
</code></pre></div></div>

<h6 id="move-easy-rsa">Move easy-rsa.</h6>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo cp</span> <span class="nt">-r</span> /usr/share/easy-rsa /etc/openvpn/easy-rsa
</code></pre></div></div>

<h6 id="find-export-easy_rsa-and-change-the-path">Find <code class="highlighter-rouge">'export EASY_RSA'</code> and change the path.</h6>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>nano /etc/openvpn/easy-rsa/vars
</code></pre></div></div>

<div class="callout callout--info">
    <p><strong>Replace:</strong>export EASY_RSA="`pwd`</p>
    <p><strong>With:</strong>export EASY_RSA="/etc/openvpn/easy-rsa"</p>
</div>

<h6 id="execute-the-following-commands">Execute the following commands.</h6>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cd</span> /etc/openvpn/easy-rsa
<span class="nb">sudo </span>su
<span class="nb">source </span>vars
<span class="nb">ln</span> <span class="nt">-s</span> openssl-1.0.0.cnf openssl.cnf
</code></pre></div></div>

<p>(sudo cp /etc/openvpn/easy-rsa/openssl-1.0.0.cnf /etc/openvpn/easy-rsa/openssl.cnf)</p>

<h6 id="create-cert-and-keys-replace-anyname-by-whatever-name-you-want">Create cert and keys. Replace <code class="highlighter-rouge">'anyName'</code> by whatever name you want.</h6>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./clean-all
./build-ca OpenVPN
./build-key-server server
./build-key-pass <span class="s1">'anyName'</span>
./build-dh

<span class="nb">exit</span>
</code></pre></div></div>

<h6 id="create-openvpn-server-conf-file">Create openvpn server conf file.</h6>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>nano /etc/openvpn/openvpn.conf
</code></pre></div></div>

<div class="example"></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>dev tun
proto udp
port 1194

ca /etc/openvpn/easy-rsa/keys/ca.crt
cert /etc/openvpn/easy-rsa/keys/server.crt
key /etc/openvpn/easy-rsa/keys/server.key
dh /etc/openvpn/easy-rsa/keys/dh2048.pem

server 10.8.0.0 255.255.255.0

push <span class="s2">"redirect-gateway def1 bypass-dhcp"</span>
push <span class="s2">"dhcp-option DNS 217.237.150.188"</span>
push <span class="s2">"dhcp-option DNS 8.8.8.8"</span>
log-append /var/log/openvpn

persist-key
persist-tun
<span class="c">#user nobody</span>
<span class="c">#group nogroup</span>
status /var/log/openvpn-status.log
verb 3
client-to-client
comp-lzo

script-security 2
up /home/pi/vpn-up
down /home/pi/vpn-down
</code></pre></div></div>

<div class="callout callout--info">
    <p>1194 is the default port used by openvpn. Change port if needed.</p><p>See XXXXX for vpn-up and vpn-down configuration.</p>
</div>

<h6 id="execute-the-following-commands-replace-anyname-with-the-name-you-want-to-give-to-your-ovpn-file-the-same-name-as-defined-above">Execute the following commands. Replace <code class="highlighter-rouge">'anyName'</code> with the name you want to give to your .ovpn file (the same name as defined above).</h6>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>su
<span class="nb">cd</span> /etc/openvpn/easy-rsa/keys
nano <span class="s1">'anyName'</span>.ovpn
</code></pre></div></div>

<div class="example"></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>dev tun
client
proto udp
remote <span class="s1">'yourDomainName.com'</span> 1194
resolv-retry infinite
nobind
persist-key
persist-tun
ca ca.crt
cert <span class="s1">'anyName'</span>.crt
key <span class="s1">'anyName'</span>.key
comp-lzo
verb 3
</code></pre></div></div>

<h6 id="install-zip-so-you-can-create-compressed-folders">Install zip so you can create compressed folders.</h6>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>apt-get <span class="nb">install </span>zip
</code></pre></div></div>

<h6 id="create-a-compressed-folder-in-your-home-directory-the-folder-will-contain-all-the-files-needed-to-connect-to-your-vpn-server-change-anyname">Create a compressed folder in your home directory. The folder will contain all the files needed to connect to your vpn server. Change <code class="highlighter-rouge">'anyName'</code>.</h6>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>zip /home/pi/raspberry_<span class="s1">'anyName'</span>.zip ca.crt <span class="s1">'anyName'</span>.crt <span class="s1">'anyName'</span>.key <span class="s1">'anyName'</span>.ovpn
</code></pre></div></div>

<h6 id="define-ownership-change-anyname">Define ownership. Change <code class="highlighter-rouge">'anyName'</code>.</h6>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">chown </span>pi:pi /home/pi/<span class="s1">'anyName'</span>.zip

<span class="nb">exit</span>
</code></pre></div></div>

<h6 id="to-access-the-local-network-through-a-vpn-tunnel-we-need-a-redirection">To access the local network through a VPN tunnel, we need a redirection.</h6>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>nano /etc/init.d/rpivpn
</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#! /bin/sh</span>
<span class="c">### BEGIN INIT INFO</span>
<span class="c"># Provides:          rpivpn</span>
<span class="c"># Required-Start:    $remote_fs $syslog</span>
<span class="c"># Required-Stop:     $remote_fs $syslog</span>
<span class="c"># Default-Start:     2 3 4 5</span>
<span class="c"># Default-Stop:      0 1 6</span>
<span class="c"># Short-Description: VPN initialization script</span>
<span class="c">### END INIT INFO</span>

<span class="nb">echo</span> <span class="s1">'echo "1" &gt; /proc/sys/net/ipv4/ip_forward'</span> | <span class="nb">sudo</span> <span class="nt">-s</span>

iptables <span class="nt">-A</span> INPUT <span class="nt">-i</span> tun+ <span class="nt">-j</span> ACCEPT
iptables <span class="nt">-A</span> FORWARD <span class="nt">-i</span> tun+ <span class="nt">-j</span> ACCEPT

iptables <span class="nt">-A</span> FORWARD <span class="nt">-m</span> state <span class="nt">--state</span> ESTABLISHED,RELATED <span class="nt">-j</span> ACCEPT
iptables <span class="nt">-t</span> nat <span class="nt">-F</span> POSTROUTING
iptables <span class="nt">-t</span> nat <span class="nt">-A</span> POSTROUTING <span class="nt">-s</span> 10.8.0.0/24 <span class="nt">-o</span> eth0 <span class="nt">-j</span> MASQUERADE
</code></pre></div></div>

<h6 id="define-correct-access-rights-and-make-it-start-at-boot">Define correct access rights and make it start at boot.</h6>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo chmod</span> +x /etc/init.d/rpivpn
<span class="nb">sudo </span>update-rc.d rpivpn defaults
<span class="nb">sudo</span> /etc/init.d/rpivpn
</code></pre></div></div>

<h6 id="restart-openvpn">Restart openvpn.</h6>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo</span> /etc/init.d/openvpn restart
</code></pre></div></div>

<h2 id="credit">Credit</h2>
<ul>
  <li><a href="https://www.ionos.fr/digitalguide/serveur/configuration/installer-un-serveur-vpn-via-raspberry-pi-et-openvpn/">Installer un serveur VPN Ã  partir de Raspberry Pi : tutoriel avec OpenVPN</a>.</li>
</ul>

							

						</div><!-- /.c-post -->
					</div><!-- /.o-col -->
				
				
					<div class="o-col-3@lg o-offset-1@lg o-offset-2@xl">
						<ul class="c-page-nav u-sticky u-pin-t-6 u-mt-4 u-mt-1@lg u-mb-1 u-mb-4@lg">
							
							
								
									<li class="is-active">
										<a href="/documentation/1-Static_IP/">
											<p class="c-page-nav__heading">Virtual Private Network (VPN)</p>
										</a>
									</li>
								
							
								
									<li class="is-active">
										<a href="/documentation/3-OpenVPN/">
											<p class="c-page-nav__heading">OpenVPN</p>
										</a>
									</li>
								
							
								
									<li>
										<a href="/documentation/5-Danted/">
											<p class="c-page-nav__heading">Danted</p>
										</a>
									</li>
								
							
								
									<li>
										<a href="/documentation/6-Start_Chain/">
											<p class="c-page-nav__heading">OpenVPN + Privoxy + Danted</p>
										</a>
									</li>
								
							
								
									<li>
										<a href="/documentation/100-Examples/">
											<p class="c-page-nav__heading">EXAMPLES</p>
										</a>
									</li>
								
							
						</ul><!-- /.c-page-nav -->
					</div><!-- /.o-col -->
				
			</div><!-- /.o-row -->
		</div><!-- /.o-container -->
	</div>




	<div class="u-bg-primary u-text-white u-pt-3 u-pt-4@sm u-pb-3 u-pb-4@sm">
		<div class="o-container">
			<div class="o-row">
				<div class="o-col-12 u-text-center">
					<div class="u-inline-block u-flex@sm">
						
						
							
							
							
						
							
							
							
						
							
							
							
						
							
							
							
						
							
							
							
						
					</div>
				</div><!-- /.o-col -->
			</div><!-- /.o-row -->
		</div><!-- /.o-container -->
	</div>




	

		
			<footer class="c-footer">
				<div class="o-container">
					<div class="o-row">
						<div class="o-col-12 u-mt-6 u-mt-8@md u-mb-4 u-mb-6@md">
							
								<p class="c-logo u-mb-1">
									r-pi
								</p><!-- /.c-logo -->
							
							
								<p>Copyright &copy; 2018. - r-pi <br>All rights reserved.</p>
							
						</div><!-- /.o-col -->
					</div><!-- /.o-row -->
				</div><!-- /.o-container -->
			</footer><!-- /.c-footer -->
		

		<script type="text/javascript" src="/dox-theme/assets/js/vendor/jquery-3.3.1.min.js"></script>
		<script type="text/javascript" src="/dox-theme/assets/js/scripts.min.js"></script>

		

	</body>
</html>


